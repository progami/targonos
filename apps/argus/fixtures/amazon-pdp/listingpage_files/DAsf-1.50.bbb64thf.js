(function(){"use strict";const ne=e=>{console.debug(e)},u=(e,t)=>{console.error(e,JSON.stringify(t)),Ee("ERROR",e,ve(e,t))},ie=(e,t)=>{console.error(e,JSON.stringify(t)),Ee("FATAL",e,ve(e,t))},Ee=(e,t,n)=>{var i;(i=window.ueLogError)==null||i.call(window,n,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},ve=(e,t)=>t instanceof Error?t:t?new Error(t):new Error(e),se=(e,t,n)=>(...i)=>{try{e(...i)}catch(s){t==null||t(n||"Error in handler",s)}},St=e=>Ct(e),Pt=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,Ie=e=>Pt.test(e),yt=e=>Ie(e)?St(e):e,be=e=>Ie(e)?e:At(e),At=e=>btoa(unescape(encodeURIComponent(e))),Ct=e=>decodeURIComponent(escape(atob(e))),Tt=e=>e&&e.split("&c=${AAX_PAYLOAD}").join(""),_t=(e,t,n)=>"".concat(e).concat(n?":".concat(n.placementName):""," - ").concat(t),O=(e,t,n)=>{var s;const i=_t(e,t,n);return(s=performance==null?void 0:performance.mark)==null||s.call(performance,i),i},N=e=>{if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(t){u("Error with 'setEntity' CSA",t)}},g=(e,t,n=1)=>{if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:n},{ent:"all"})}catch(i){u("Error with 'logCsaEvent' CSA",i)}},V=(e,t=1)=>{if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e,metricValue:t},{ent:"all"})}catch(n){u("Error with 'incrementCounter' CSA",n)}},Nt=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,re=new Map,Se=()=>{if(!re.has(window.location.href)){const e=Nt.exec(window.location.href),t=e&&e[3]?e[3]:null;re.set(window.location.href,t)}return re.get(window.location.href)},Pe=e=>{const t=Se();if(!e||!t)return null;const n=e.split(":");return n.splice(n.length-1,0,t),n.join(":")},ye=e=>{const t=Se();return t?"".concat(e,":").concat(t):null},oe=e=>e.replace(/_/g,":"),d=(e,t,n=1)=>{if(!Ae())return;const i=(s,r,o)=>{r&&Ce("".concat(_e(s),":").concat(r),o)};i(e,t.id,n),i(e,ye(t.id),n),i(e,oe(t.name),n),i(e,Pe(oe(t.name)),n)},m=(e,t=1)=>{Ae()&&Ce(_e(e),t)},Ae=()=>{var e;return typeof((e=window==null?void 0:window.ue)==null?void 0:e.count)=="function"},Ce=(e,t)=>{var n;return(n=window==null?void 0:window.ue)==null?void 0:n.count(e,t)},Te="adplacements",_e=e=>e.startsWith(Te)?e:"".concat(Te,":").concat(e),Lt="adload:renderstart",Mt="adload:renderend",Rt="adload:creativewritten",xt="adload:start",kt="adload:delayloadcallback",Ot="adload_renderstart",Vt="adload_renderend",Bt="adload_creativewritten",Ht="adload_start",Ft="adload_delayload",b=(e,t)=>{Ut()&&Wt(e+$t(t))},Ut=()=>{var e;return typeof((e=window==null?void 0:window.ue)==null?void 0:e.tag)=="function"},Wt=e=>{var t;return(t=window==null?void 0:window.ue)==null?void 0:t.tag(e)},$t=e=>e?":".concat(e):"",Yt=e=>{if(!(e!=null&&e.adCreativeMetaData)||!Object.keys(e.adCreativeMetaData).length){b("noadrender"),N({adrender:"false"});return}b("adrender"),b("adrender:safeframe"),Jt(e),Gt(e),Kt(e),zt(e)},Jt=e=>{const t=Ne(e);b("adrender","creativetemplatename:"+t),N({adrender:"true",creativeTemplateName:t,isLightAds:"false"})},Ne=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Gt=e=>{e.adCreativeMetaData.adCreativeId&&(b("adrender","creativeid:"+e.adCreativeMetaData.adCreativeId),N({creativeId:e.adCreativeMetaData.adCreativeId}))},Kt=e=>{e.adCreativeMetaData.adProgramId&&(b("adrender","programid:"+e.adCreativeMetaData.adProgramId),N({adProgramId:e.adCreativeMetaData.adProgramId}))},zt=e=>{e.isCardsFlow!==void 0&&N({isCardsFlow:e.isCardsFlow.toString()})},qt="aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ",Xt="https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",ae="APE_CW_METRICS",jt=10;let Le=!1;const Me=e=>{Le||(window.addEventListener("beforeunload",()=>Dt()),Le=!0);const t=Re();t.push(e),t.length>=jt?xe(t):Qt(t)},Re=()=>{const e=localStorage.getItem(ae);if(!e)return[];try{return JSON.parse(e)}catch(t){return[]}},xe=e=>{navigator.sendBeacon(Xt,JSON.stringify(Zt(e))),localStorage.removeItem(ae)},Zt=e=>({metrics:e,xApiKey:qt}),Qt=e=>{localStorage.setItem(ae,JSON.stringify(e))},Dt=()=>{const e=Re();e.length>0&&xe(e)},S=(e,t)=>{const n=()=>{var i,s;return(s=(i=e==null?void 0:e.renderingWeblabs)==null?void 0:i[t])==null?void 0:s.toLowerCase()};return{isT1(){return n()==="t1"},isT2(){return n()==="t2"},getTreatment(){return n()}}},en=()=>S(window,"ADPT_SF_LOW_RATE_METRIC_LOGGING_1256362"),tn=()=>S(window,"ADPT_SF_SERVER_SIDE_SPONSORED_LABEL_998980"),nn=()=>S(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_RATE_EXPERIMENT_1289633"),B=()=>S(window,"APM_STORES_JPS_JRS_CREATIVE_BOOKS_ADS_1277965"),ke=()=>S(window,"APM_STORES_JPS_JRS_SAFEFRAME_1318775"),sn=()=>S(window,"APM_STORES_JPS_JRS_SAFEFRAME_NEW_VIEWABILITY_TRACKER_1354300"),rn=e=>{var n,i;if(!window.APE_SF)return;const t=(i=(n=window.APE_SF).loggedMetricNames)!=null?i:n.loggedMetricNames=new Set;t.has(e.metricName)||(t.add(e.metricName),Me(e))},y=({metricName:e,adDetails:t,count:n=1,additionalDimensions:i={},once:s=!1})=>{en().isT1()&&(s?rn:Me)(on(e,n,an(t,i)))},on=(e,t,n)=>({metricName:e,timestamp:new Date().getTime(),value:t,dimensions:n}),an=(e,t)=>{var n,i;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:(n=e.adCreativeMetaData)==null?void 0:n.adProgramId,creativeTemplateName:(i=e.adCreativeMetaData)==null?void 0:i.adCreativeTemplateName,deviceType:e.deviceType,...t}},cn={DESKTOP:16,MSHOP:10,MWEB:10},A=e=>(e==null?void 0:e.length)>1&&e.charAt(e.length-1)==="%",L=e=>A(e)?e:"".concat(parseInt(e),"px"),Oe=(e,t="MWEB")=>{if(A(e))return e;const n=parseFloat(e),i=cn[t];return!n||!i?"inherit":"".concat(n/i,"lh")},dn=(e,t)=>{const n=i=>A(i)?i:parseInt(i);y({metricName:"creative:size:changeSize",adDetails:e,additionalDimensions:{postSize:"".concat(n(t.width),"x").concat(n(t.height))}})},ln=e=>{mn.has(e.slotName)&&y({metricName:"responsivePlacement",adDetails:e,additionalDimensions:{responsiveCreative:String(e.responsiveCreative),responsivePlacement:String(e.responsivePlacement),creativeId:e.adCreativeMetaData.adCreativeId}})},mn=new Set(["desktop-homepage-btf-card-1","desktop-homepage-btf-card-2","desktop-homepage-btf-card-3","desktop-homepage-btf-left","abgw-btf-card-1","ams-detail-right-pbook","goldbox-ads","fresh-hero-quick-promo","wfm-hero-quick-promo","fresh-odp-desktop-ad-2","dynamic-zoetrope-1","mobile-app-detail-lpo","mobile-detail-lpo","desktop-detail-lpo","ee-vssm-desktop-1","ee-vssm-desktop-5","ee-vssm-desktop-9","merchandised-search-3","merchandised-search-9","merchandised-vssm-desktop-1","merchandised-vssm-desktop-2","merchandised-vssm-desktop-3","merchandised-vssm-desktop-4","merchandised-vssm-desktop-5","merchandised-vssm-desktop-6","merchandised-vssm-mobile-1","merchandised-vssm-mobile-2","merchandised-vssm-mobile-3","merchandised-vssm-mobile-4","merchandised-vssm-mobile-5","merchandised-vssm-mobile-6"]),Ve="adplacements:retailClickTracking:failure",hn="adplacements:retailClickTracking:clickSuccess",un="adplacements:retailClickTracking:missingUrl",gn=async e=>{const t=document.getElementById(e);t==null||t.removeAttribute("onclick");const n=t==null?void 0:t.getAttribute("data-click-addr");if(!n){window.ue.count(un,1);return}try{(await fetch(n,{keepalive:!0})).ok?window.ue.count(hn,1):window.ue.count(Ve,1)}catch(i){window.ue.count(Ve,1)}},C=e=>{const{adUnitIframeId:t}=e,n=document.getElementById(t);if(!n){const{readyState:i}=document;m("getiframe:undefined"),y({metricName:"html:element:missing:iframe",adDetails:e,additionalDimensions:{readyState:i,adUnitIframeId:t}})}return n},pn=Array.from({length:100},(e,t)=>(t+1)/100),wn=(e,t)=>{const n=C(e);n&&new IntersectionObserver(i=>i.forEach(s=>fn(e,t,s)),{threshold:pn}).observe(n)},fn=(e,t,{target:n,intersectionRect:i,boundingClientRect:s,intersectionRatio:r})=>{const o=n,a=i.width/s.width,c=i.height/s.height;t.sendMessageToAd(e.arid,"populateSafeFrameExt",{geom:{self:{t:s.top,l:s.left,r:s.right,b:s.bottom,xiv:a,yiv:c,iv:r,z:1,w:o.offsetWidth,h:o.offsetHeight}},inViewPercentage:Math.round(r*100)})},En=(e,t)=>{const n=C(e);n&&setInterval(()=>{const i=n.getBoundingClientRect();t.sendMessageToAd(e.arid,"populateGeom",{geom:{self:{t:i.top,l:i.left,r:i.right,b:i.bottom,z:1,w:n.offsetWidth,h:n.offsetHeight}}})},250)},w=e=>{const t=document.getElementById(e.adUnitPlacementId);return t||(m("getplacement:undefined"),y({metricName:"html:element:missing:placement",adDetails:e})),t},vn="nav-ewc-persistent-hover",In="div#nav-flyout-ewc",Be="nav-cart",bn="--nav-cart-full-width",Sn="--nav-cart-half-width",Pn=e=>{const t=document.documentElement,n=w(e);He(t,n),new MutationObserver(i=>{for(const s of i)if(s.type==="attributes"&&s.attributeName==="class"){const r=s.target;He(r,n)}}).observe(t,{attributes:!0,attributeFilter:["class"]})},He=(e,t)=>{if(e.classList.contains(vn)){t.classList.add(Be);const n=yn();t.style.setProperty(bn,"".concat(n,"px")),t.style.setProperty(Sn,"".concat(n/2,"px"))}else t.classList.remove(Be)},yn=()=>{const e=document.querySelector(In);return e instanceof HTMLElement?e.offsetWidth:0},An=e=>({onSafeFrameReady(t){v("eventsChannel:onSafeFrameReady",t),O("perf:sf:host","safeFrameReady",t),e.sendMessageToAd(t.arid,"setupComputedAdDetails",{aPageStart:window.aPageStart,adStartTime:new Date().getTime()}),window.addEventListener("resize",()=>{e.sendCustomMessageToAd(t.arid,"resize",{height:window.innerHeight,width:window.innerWidth})}),Yt(t),Pn(t),wn(t,e),En(t,e)},onPreCreativeWrite(t){v("eventsChannel:onPreCreativeWrite",t);const n={id:t.placementId,name:t.placementName};d(Lt,n),g(Ot,n)},onPostCreativeWrite(t){v("eventsChannel:onPostCreativeWrite",t);const n={id:t.placementId,name:t.placementName};d(Mt,n),g(Vt,n)},onCreativeBeginToRender(t){v("eventsChannel:onCreativeBeginToRender",t)},onCreativeLoad(t){v("eventsChannel:onCreativeLoad",t);const n={id:t.placementId,name:t.placementName};d(Rt,n),g(Bt,n),ln(t)},onError(t){v("eventsChannel:onError",t)},onClick(t){v("eventsChannel:onClick",t),gn(t.adUnitPlacementId)}}),v=(e,t)=>{m(e),d(e,{id:t.placementId,name:t.placementName},performance.now())};function Cn(e,t,n){e.addEventListener(t,i=>{n(i)})}const Fe="sfVideoContinuousPlaytimeSeconds",Tn=e=>{let t=0;return Cn(e.div,Fe,n=>{t=n.detail.sfVideoContinuousPlaytimeSeconds}),{shouldFirePixel(){return t>=2}}},_n=["fresh-desktop-detail-ilm","wfm-desktop-detail-ilm","alm-weis-desktop-detail-ilm","alm-save-desktop-detail-ilm","alm-lucky-desktop-detail-ilm","alm-bristol-desktop-detail-ilm","alm-rite-desktop-detail-ilm","alm-bartell-desktop-detail-ilm","alm-cardenas-desktop-detail-ilm","alm-petfoodexpress-desktop-detail-ilm","alm-allthebestpetcare-desktop-detail-ilm"],Nn=(e,t,n)=>{if(window.csa)try{window.csa("Content",{element:e})("mark",t,n==null?void 0:n.getTime())}catch(i){u("Error with 'mark' CSA",i)}},Ue={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},We=({latencyEvent:e,scope:t,placement:n,timestamp:i})=>{var s,r;Ln(e)&&(H(e,F(t),n.id,i),H(e,F(t),oe(n.name),i),H(e,F(t),(s=Pe(n.name))!=null?s:void 0,i),H(e,F(t),(r=ye(n.id))!=null?r:void 0,i))},Ln=e=>typeof window[Ue[e]]=="function",H=(e,t,n,i=new Date)=>{const s=Ue[e];!n||typeof window[s]!="function"||window[s](e,t+n,{wb:1},i)},F=e=>"adplacements:"+Mn(e),Mn=e=>e?"".concat(e,":"):"";class Rn{sendLatencyMetric({latencyMetricType:t,placementId:n,placementName:i,placementDivId:s,timestamp:r}){We({latencyEvent:t.csmKey,scope:t.csmMessage,placement:{id:n,name:i},timestamp:r}),Nn(document.getElementById(s),t.csaKey,r)}}const T=()=>new Rn,xn=(e,t)=>{const n=kn(t);let i=0;for(const[s,r]of n){if(!On(s,r))continue;const o=document.elementFromPoint(s,r);o&&Vn(o,e)&&i++}return i/n.length},kn=e=>{const n=[];for(let i=0;i<10;i++)n.push([e.left+e.width/2,e.top+e.height*(i+.5)/10]);return n},On=(e,t)=>{const n=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return e>=0&&e<=n&&t>=0&&t<=i},Vn=(e,t)=>{if(!(e instanceof HTMLElement)||e===t||t.contains(e))return!1;const n=window.getComputedStyle(e);if(n.display==="none"||n.visibility==="hidden"||n.pointerEvents==="none"||parseFloat(n.opacity)<.7)return!1;const i=n.backgroundColor;return!((i==="transparent"||/,0\)$/.test(i)||i==="")&&!n.backgroundImage.includes("url"))},Bn=(e,t)=>{const n=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),i=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));if(n===0||i===0)return 0;const s=n*i,r=e.width*e.height;return s/r},U=e=>{const{height:t,top:n,left:i=0,width:s=Hn()}=e;return{top:n,bottom:n+t,left:i,right:i+s,width:s,height:t}},Hn=()=>window.innerWidth||document.documentElement.clientWidth,ce="mash",Fn=async e=>new Promise((t,n)=>{if(!P){n(new Error("mash:getobstructions:missing"));return}const i=setTimeout(()=>{n(new Error("mash:getobstructions:timeout"))},e),s=performance.now();P.when(ce).execute(r=>{var o,a;if(!((a=(o=r==null?void 0:r.appCX)==null?void 0:o.uiOrchestrator)!=null&&a.getObstructions)){clearTimeout(i),n(new Error("mash:getobstructions:missing"));return}r.appCX.uiOrchestrator.getObstructions({successCallback:c=>{clearTimeout(i),t({boundingBoxes:(c.boundingBoxes||[]).map(U),isFullyObstructed:c.isFullyObstructed,latencyMs:performance.now()-s})},failCallback:()=>{clearTimeout(i),n(new Error("mash:getobstructions:failure"))}})})}),Un=e=>{if(!P){m("mash:missing",1);return}P.when(ce).execute(t=>{t==null||t.addEventListener("obstructionsChanged",e)})},Wn=e=>{if(!P){m("mash:missing",1);return}P.when(ce).execute(t=>{t==null||t.removeEventListener("obstructionsChanged",e)})},$n=(e,t)=>{const n=t.getObstructingRectangles();return n.length===0?0:n.reduce((s,r)=>s+Bn(e,r),0)},Yn=async e=>{try{e.setObstructingRectangles([]),e.listenerHandler||(e.listenerHandler=i=>Jn(i,e),Un(e.listenerHandler));const n=await Fn(950);e.setObstructingRectangles(Gn(n,e))}catch(n){W(n.message,e)}},Jn=(e,t)=>{var n;t.setObstructingRectangles((((n=e==null?void 0:e.detail)==null?void 0:n.boundingBoxes)||[]).map(U))},Gn=(e,t)=>e.isFullyObstructed?(W("viewPixel:iab:obstruction:native:fullviewport",t,1),[U({height:window.innerHeight,top:0})]):(Kn(e.boundingBoxes,t),e.boundingBoxes.map(U)),W=(e,t,n=1)=>{t.metricsLogged.has(e)||(m(e,n),V(e,n),t.metricsLogged.add(e))},Kn=(e,t)=>{for(const n of e)W("mash:getobstructions:response:height",t,n.height),W("mash:getobstructions:response:top",t,n.top)},zn=e=>{if(e.listenerHandler){try{Wn(e.listenerHandler)}catch(t){}e.listenerHandler=void 0}},$=()=>{let e=[];const n={metricsLogged:new Set,listenerHandler:void 0,setObstructingRectangles:i=>{e=i},getObstructingRectangles:()=>e};return Yn(n),{getObstructionPercentage({element:i,elementDOMRectOverride:s=i.getBoundingClientRect()}){const r=xn(i,s),o=$n(s,n);return Math.max(r,o)},cleanup(){zn(n)}}};class $e{constructor(t,n,i,s,r){this.pixel=t,this.viewabilityStandard=n,this.visibilityChangeService=i,this.viewabilityService=s,this.videoPixelValidator=r,this.metricsLogged=new Set,this.wasObstructed=!1,this.emitObstructionRecoveryMetrics=o=>{this.wasObstructed&&this.logMetrics("viewpixel:iab:obstruction:recovered",1,o)},this.logMetrics=(o,a=1,c)=>{this.metricsLogged.has(o)||(m(o,a),V(o,a),c&&(d(o,c,a),g(o,c,a)),this.metricsLogged.add(o))}}postPixelFireCleanup(t,n){t.unobserve(n.div),clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection(),this.emitObstructionRecoveryMetrics(n),this.viewabilityService.cleanup()}postPlacementExitsViewportCleanup(){clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),clearInterval(this.shouldFirePixelIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection()}fireInObserver(t,n){this.fire(n),this.postPixelFireCleanup(t,n)}startInViewTimer(t,n){this.viewTimerTimeoutId=setTimeout(()=>this.fireInObserver(t,n),this.viewabilityStandard.thresholdTimeVisibleMs),this.performContinuousObstructionCheck(t,n),this.visibilityChangeService.setupVisibilityChangeDetection(this.viewTimerTimeoutId,t,n)}performContinuousObstructionCheck(t,n){this.obstructionCheckIntervalId=setInterval(()=>{try{this.viewabilityService.isViewabilityObstructed(n,this.viewabilityStandard.thresholdPercentage)&&(this.wasObstructed=!0,clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.startInViewTimer(t,n))}catch(s){ie(s==null?void 0:s.message,s),clearInterval(this.obstructionCheckIntervalId)}},100)}track(t){new IntersectionObserver((n,i)=>{n.forEach(s=>{s.isIntersecting?this.startInViewTimer(i,t):this.postPlacementExitsViewportCleanup()})},{threshold:this.viewabilityStandard.thresholdPercentage}).observe(t.div)}async fire(t){this.videoPixelValidator&&!this.videoPixelValidator.shouldFirePixel()&&await this.waitUntilShouldFirePixel(),this.pixel.fire(t)}waitUntilShouldFirePixel(){return new Promise(t=>{this.shouldFirePixelIntervalId=setInterval(()=>{this.videoPixelValidator&&this.videoPixelValidator.shouldFirePixel()&&(clearInterval(this.shouldFirePixelIntervalId),t())},100)})}}const Ye={keepalive:!0,mode:"no-cors"};class Y{constructor(t,n,i,s,r,o=[]){this.url=t,this.loggingContext=n,this.generatePixelUrl=i,this.pixelIdentifier=s,this.pixelLogger=r,this.urls3p=o,this.isFired=!1,this.pixel=a=>{const c=document.createElement("img");return c.id="".concat(this.pixelIdentifier.testId,"_").concat(a.name),c.style.display="none",c.setAttribute("pixel-url",this.generatePixelUrl(this.url,a)),c}}async fire(t){this.isFired||(await fetch(this.generatePixelUrl(this.url,t),Ye),t.div.appendChild(this.pixel(t)),this.isFired=!0,this.pixelLogger(this.pixelIdentifier,this.loggingContext,t),this.urls3p.forEach(n=>fetch(n,Ye)))}}const qn={testId:"ape_btr_impression",csmLogId:"imp:btr"},Xn={testId:"ape_impression",csmLogId:"imp:cod"},jn={testId:"ape_measurability",csmLogId:"imp:atf"},Zn={testId:"ape_impression",csmLogId:"imp:skan"},Qn={testId:"skan_view_pixel",csmLogId:"view:skan"},Dn={testId:"ape_viewability_iab",csmLogId:"view:iab"},_=(e=m,t=d)=>(n,i,s)=>{var r;e("pixel:".concat(n.csmLogId)),t("pixel:".concat(n.csmLogId),s),e("pixel:".concat(n.csmLogId,":").concat(i.aaxProgramId)),e("pixel:".concat(n.csmLogId,":device:").concat((r=s.deviceType)==null?void 0:r.toLowerCase()))},Je={H1_DESKTOP_HEIGHT:240,H1_DESKTOP_WIDTH:940},ei=e=>{if(ti(e)){const t={height:Je.H1_DESKTOP_HEIGHT,width:Je.H1_DESKTOP_WIDTH};return ni(e.div,t)}return e.div.getBoundingClientRect()},ti=e=>e.name.toLowerCase()==="gateway_desktop-h1_desktop",ni=(e,t)=>{const n=e.getBoundingClientRect(),s=(n.left+n.right)/2-t.width/2;return new DOMRect(s,n.y,t.width,t.height)},ii=e=>{const t=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,i={top:Math.max(0,e.top),left:Math.max(0,e.left),bottom:Math.min(t,e.bottom),right:Math.min(n,e.right)};if(e.top>=t||e.left>=n||e.bottom<=0||e.right<=0||e.width<=0||e.height<=0)return 0;const s=(i.right-i.left)*(i.bottom-i.top),r=e.width*e.height;return s/r},si=e=>{var n;const t=e.placement.div.getBoundingClientRect();return{v:{def:e.definition,p:e.thresholdPercentage,t:e.thresholdTimeVisibleMs,ib:e.isBtr},wh:window.innerHeight||document.documentElement.clientHeight,ww:window.innerWidth||document.documentElement.clientWidth,sx:window.scrollX,sy:window.scrollY,ah:t.height,aw:t.width,top:t.top,left:t.left,ptv:(new Date().getTime()-((n=window.aPageStart)!=null?n:0))/1e3,ttv:(new Date().getTime()-e.adStartTime)/1e3}},J=e=>{const t=new Set,n=(s,r=1,o)=>{t.has(s)||(m(s,r),V(s,r),o&&(d(s,o,r),g(s,o,r)),t.add(s))},i=(s,r)=>{const o=ei(s),a=ii(o),c=e.getObstructionPercentage({element:s.div,elementDOMRectOverride:o}),l=a-c<r;return l&&n("viewpixel:iab:obstruction",1,s),l};return{isViewabilityObstructed(s,r){return i(s,r)},cleanup(){e.cleanup()}}},Ge=()=>{const e=(t,n,i)=>{document.hidden?(clearTimeout(t),n.unobserve(i.div)):n.observe(i.div)};return{removeVisibilityChangeDetection(){this.activeVisChangeHandler&&(document.removeEventListener("visibilitychange",this.activeVisChangeHandler),this.activeVisChangeHandler=void 0)},setupVisibilityChangeDetection(t,n,i){this.removeVisibilityChangeDetection(),this.activeVisChangeHandler=()=>e(t,n,i),document.addEventListener("visibilitychange",this.activeVisChangeHandler)}}},Ke="AppAdsMshopIOSPlugin",ri=e=>{var t;(t=window.P)==null||t.when(Ke).execute(n=>{n.startAttributeViewThroughAppAds({skAdNetwork:e})})},oi=e=>{var t;(t=window.P)==null||t.when(Ke).execute(n=>{n.endAttributeViewThroughAppAds({skAdNetwork:e})})};class ai{constructor(t,n,i){this.loggingContext=t,this.skAdNetwork=n,this.pixelLogger=i,this.isFired=!1}async fire(t){this.isFired||(ri(this.skAdNetwork),this.isFired=!0,this.pixelLogger(Zn,this.loggingContext,t))}}class ci{constructor(t,n,i){this.loggingContext=t,this.pixelLogger=n,this.skAdNetwork=i,this.isFired=!1}async fire(t){this.isFired||(oi(this.skAdNetwork),this.isFired=!0,this.pixelLogger(Qn,this.loggingContext,t))}}const di="btr_client",ze="cod_client",qe="atf",Xe="v",li="pj",mi="c",G=/\${AAX_TYPE}/,je=/\${AAX_PAYLOAD}/,hi="{}",ui="",Ze=(e,t,n)=>{if(t===ui)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));const i=new URL(e),s=i.searchParams.get(t),o=JSON.parse(s||hi),a=Object.assign(o,n);return i.searchParams.set(t,JSON.stringify(a)),i.toString()},gi=e=>Ze(Tt(e),mi,{measurementMethod:di}),pi=e=>{const t=e.includes(".paets.");return Ze(e,li,t?{}:{measurementMethod:ze})},K=()=>window.innerHeight||document.documentElement.clientHeight,de=()=>window.innerWidth||document.documentElement.clientWidth,wi=e=>e.getBoundingClientRect().top-K(),fi=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),le=e=>{const t=e.getBoundingClientRect();return fi(t,Number(window.getComputedStyle(e,null).zIndex))},Ei=e=>{const t=Ii(e);return t==null?"unknown":t>=.5},vi=e=>e.width===0&&e.height===0;function Ii(e){const t=document.body.getBoundingClientRect();if(vi(t))return null;const n=le(e),i=K(),s=de(),r=Math.max(0,Math.min(t.left+s,n.r)-n.l),o=Math.max(0,Math.min(t.top+i,n.b)-n.t),a=r*o/(n.h*Math.min(n.w,s));return Number(Math.min(1,Math.max(0,a)).toFixed(2))}const bi=(e,t)=>{const n=le(e),i=le(t),s=de(),r=K();return n&&i&&(Math.abs(n.t-i.b)<r||Math.abs(n.b-i.t)<r)&&(Math.abs(n.l-i.r)<s||Math.abs(n.r-i.l)<s)},Si=(e,t)=>{const n={atf:Ei(t.div)},i=encodeURIComponent(JSON.stringify(n));return G.test(e)?e.replace(G,qe).replace(je,i):"".concat(e.replace(/\/$/,""),"/").concat(qe,"/").concat(i)},Qe={set:(e,t)=>{e.div.dataset.isBtr=String(t)},get:e=>e.div.dataset.isBtr===String(!0)},Pi=e=>{const t=new Date().getTime();return(n,i)=>{const s={placement:i,definition:e.definition,thresholdPercentage:e.thresholdPercentage,thresholdTimeVisibleMs:e.thresholdTimeVisibleMs,isBtr:Qe.get(i),adStartTime:t},r=encodeURIComponent(JSON.stringify(si(s)));return G.test(n)?n.replace(G,Xe).replace(je,r):"".concat(n.replace(/\/+$/,""),"/").concat(Xe,"/").concat(r)}},z={IAB_VIDEO:{definition:"iab",thresholdPercentage:.5,thresholdTimeVisibleMs:2e3},IAB_LARGE_DISPLAY:{definition:"iab",thresholdPercentage:.3,thresholdTimeVisibleMs:1e3},IAB_DISPLAY:{definition:"iab",thresholdPercentage:.5,thresholdTimeVisibleMs:1e3},SKAN:{definition:"skan",thresholdPercentage:.5,thresholdTimeVisibleMs:2e3}},De=({target:e,onIntersection:t,onExit:n,options:i})=>{const s=new IntersectionObserver((r,o)=>{r.forEach(a=>{a.isIntersecting?t(o,a):n(o,a)})},i);return s.observe(e),s},yi=async(e,t)=>{let n,i;return new Promise(s=>{i=s,n=new IntersectionObserver(r=>{r.forEach(o=>{o.target===e&&o.isIntersecting&&(i(o),n.unobserve(e))})},t),n.observe(e)})},Ai=(e,t,n,i)=>{const s=a=>{let c;const l={wasObstructed:!1};De({target:a.div,onIntersection:h=>c=r(a,h,l),onExit:()=>c==null?void 0:c(),options:{threshold:t.thresholdPercentage}})},r=(a,c,l)=>{let h=performance.now(),p=!1;const x=setInterval(()=>{o(a)||Ti()?(l.wasObstructed=!0,p=!0):p?(h=performance.now(),p=!1):_i(h,t.thresholdTimeVisibleMs)&&Ni(i)&&(e.fire(a),k(l.wasObstructed),c.unobserve(a.div))},Ci),k=(we=!1)=>{we&&Li(a),clearInterval(x),n.cleanup()};return k},o=a=>{try{return n.isViewabilityObstructed(a,t.thresholdPercentage)}catch(c){return ie(c==null?void 0:c.message,c),!1}};return{track:s,viewabilityStandard:t}},Ci=100,Ti=()=>document.hidden,_i=(e,t)=>performance.now()-e>=t,Ni=e=>e.every(t=>t.shouldFirePixel()),Li=e=>{const t="viewpixel:iab:obstruction:recovered";m(t),V(t),d(t,e),g(t,e)},et=({btrPixelUrl:e,loggingContext:t})=>e?new Y(e,t,gi,qn,_()):void 0,tt=({aaxImpPixelUrl:e,imp3pUrls:t,loggingContext:n})=>new Y(e,n,pi,Xn,_(),t),nt=({aaxInstrPixelUrl:e,loggingContext:t})=>new Y(e,t,Si,jn,_()),Mi=(e,t,n,i,s)=>e==="V"?me(n,z.IAB_VIDEO,s()):Ri(i)&&xi(t)?me(n,z.IAB_LARGE_DISPLAY):me(n,z.IAB_DISPLAY),Ri=e=>e==="DESKTOP",xi=e=>ki(e)>=242500,ki=e=>e.getBoundingClientRect().height*e.getBoundingClientRect().width,me=(e,t,n)=>{const i=new Y(e.aaxInstrPixelUrl,e.loggingContext,Pi(t),Dn,_());return sn().isT1()?Ai(i,t,J($()),n?[n]:[]):new $e(i,t,Ge(),J($()),n)},Oi=e=>{if(e.skAdNetwork)return new ai(e.loggingContext,e.skAdNetwork,_())},Vi=e=>{if(e.skAdNetwork){const t=new ci(e.loggingContext,_(),e.skAdNetwork);return new $e(t,z.SKAN,Ge(),J($()),void 0)}},it=e=>e+"_Feedback",st=0,rt=1;class Bi{constructor(t,n,i,s,r,o,a){this.parentHtmlId=t,this.feedbackStyle=n,this.labelText=i,this.labelStyle=s,this.position=r,this.urlPathAndParameter=o,this.hidden=a}async addSponsoredLabelWithFeedbackLink(t,n){t.appendChildTo(this.parentHtmlId,this);const i=await n.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(i!=null&&i.isOk()))throw new Error("Result from the feedback service was not ok ".concat(this.urlPathAndParameter));t.updateElement(this.getHtmlId(),i)}getHtmlId(){return it(this.parentHtmlId)}isHidden(){return this.hidden}exists(t){return t.exists(this.getHtmlId())}getFeedbackSpanElement(){return document.querySelector("#".concat(this.getHtmlId()," span"))}}class Hi{constructor(t){this.parentHtmlId=t}open(t){t.clickChildLink(this)}getHtmlId(){return it(this.parentHtmlId)}}class Fi{constructor(t,n){this.feedbackHtmlPort=t,this.feedbackApiPort=n}async createSponsoredLabelWithFeedbackLink(t,n){if(!t.exists(this.feedbackHtmlPort)){n.request();try{await t.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),n.success(),t.isHidden()||n.labelRenderedHost()}catch(i){throw n.error(),i}}}openModal(t){t.open(this.feedbackHtmlPort)}labelRendered(t){t.labelRenderedCreative()}logTransparencyInfoMissing(t){t.transparencyInfoMissing()}}const he=e=>new Ui(e),M={REQUEST:"adfeedback_request",SUCCESS:"adfeedback_success",ERROR:"adfeedback_error",LABEL_RENDERED_CREATIVE:"adfeedback_sponsoredlabelrendered_creative",LABEL_RENDERED_HOST:"adfeedback_sponsoredlabelrendered_host"},f={REQUEST:"adfeedback:request",SUCCESS:"adfeedback:success",ERROR:"adfeedback:error",LABEL_RENDERED_CREATIVE:"adfeedback:sponsoredlabelrendered:creative",LABEL_RENDERED_HOST:"adfeedback:sponsoredlabelrendered:host",LABEL_RENDERED:"adfeedback:sponsoredlabelrendered",TRANSPARENCY_INFO_MISSING:"adfeedback:transparencyinfo:missing"};class Ui{constructor(t){this.placement=t}request(){d(f.REQUEST,this.placement),m(f.REQUEST),g(M.REQUEST,this.placement)}success(){d(f.SUCCESS,this.placement),m(f.SUCCESS),g(M.SUCCESS,this.placement)}error(){d(f.ERROR,this.placement),g(M.ERROR,this.placement)}labelRenderedCreative(){d(f.LABEL_RENDERED_CREATIVE,this.placement),m(f.LABEL_RENDERED),g(M.LABEL_RENDERED_CREATIVE,this.placement)}labelRenderedHost(){d(f.LABEL_RENDERED_HOST,this.placement),m(f.LABEL_RENDERED),g(M.LABEL_RENDERED_HOST,this.placement)}transparencyInfoMissing(){d(f.TRANSPARENCY_INFO_MISSING,this.placement),m(f.TRANSPARENCY_INFO_MISSING)}}class Wi{constructor(t,n,i){this.status=t,this.html=n,this.script=i}isOk(){return this.status==="ok"}}class $i{constructor(t){this.windowRepo=t}async getSponsoredLabelAndFeedbackLink(t){const n=await window.fetch(this.windowRepo.origin()+t);if(n.ok){const i=await n.json();return new Wi(i.status,i.html,i.script)}throw Error("Could not fetch the feedback html/link/script/label")}}class Yi{appendChildTo(t,n){var s,r;n.position===rt?(s=document.getElementById(t))==null||s.prepend(i(t,n)):n.position===st&&((r=document.getElementById(t))==null||r.append(i(t,n)));function i(o,a){const c=document.createElement("div");return c.setAttribute("id",a.getHtmlId()),c.classList.add("ape-feedback"),c.style.position="relative",c.style.height="auto",c.style.minHeight="20px",c.style.textAlign=c.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",c.style.padding="0",c.style.marginTop="2px",c.style.display=a.feedbackStyle.display,o.endsWith("_wrapper")&&(!o.includes("-ilm")&&(c.style.maxWidth="min(100vh, 100vw)"),c.style.marginLeft="auto",c.style.marginRight="auto",c.style.padding="0 5px"),c.append(l(a)),c;function l(h){const p=document.createElement("div");return p.innerHTML=h.labelText,Ji(p,h.labelStyle),p}}}updateElement(t,n){const i=document.getElementById(t);if(i){i.innerHTML=n.html,Gi(i,n);for(const s of i.children)s.tagName==="DIV"?s.removeAttribute("style"):s.tagName==="A"&&(s.style.removeProperty("position"),s.style.removeProperty("top"),s.style.removeProperty("right"),s.style.removeProperty("display"))}}clickChildLink(t){const n=document.getElementById(t.getHtmlId());for(const s of(n==null?void 0:n.children)||[])if(i(s)){s.click();return}function i(s){return s.tagName==="A"||s.tagName==="DIV"}}exists(t){return!!document.getElementById(t)}}const Ji=(e,t)=>{for(const n in t)e.style.setProperty(n,t[n])},Gi=(e,t)=>{const n=Ki(e);n.innerHTML=t.script},Ki=e=>{const t=document.createElement("script");return e.prepend(t),t},zi={hostname:"www.amazon.com.be"},qi={hostname:"www.amazon.fr"},Xi={hostname:"www.amazon.de"},ji={hostname:"www.amazon.it"},Zi={hostname:"www.amazon.nl"},Qi={hostname:"www.amazon.pl"},Di={hostname:"www.amazon.es"},es={hostname:"www.amazon.se"},E=e=>location.hostname===e.hostname,ts=()=>E(zi)||E(qi)||E(Xi)||E(ji)||E(Zi)||E(Qi)||E(Di)||E(es),ns=e=>!ts()||is(e),is=e=>{var i,s,r,o,a,c;const t=[];ue((r=(s=(i=e==null?void 0:e.url)==null?void 0:i.parameters)==null?void 0:s.adPlacementMetaData)==null?void 0:r.slotName)&&t.push("DSA Error: slotName missing");const n=(c=(a=(o=e==null?void 0:e.url)==null?void 0:o.parameters)==null?void 0:a.adCreativeMetaData)==null?void 0:c.adCreativeDetails;(!n||n.length<=0)&&t.push("DSA Error: transparency info missing"),n==null||n.every(l=>ss(l,t));for(const l of t)u(l);return t.length<=0},ss=(e,t)=>{var n,i,s,r,o;e.version||t.push("DSA Error: version missing"),ue(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),(((n=e.selectionSignals)==null?void 0:n.context)===void 0||((i=e.selectionSignals)==null?void 0:i.context)===null)&&t.push("DSA Error: selectionSignals.context missing"),(((s=e.selectionSignals)==null?void 0:s.location)===void 0||((r=e.selectionSignals)==null?void 0:r.location)===null)&&t.push("DSA Error: selectionSignals.location missing"),ue((o=e.selectionSignals)==null?void 0:o.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},ue=e=>!(e!=null&&e.trim()),ge=()=>{return new rs(e());function e(){return new Fi(new Yi,new $i({origin:()=>window.location.origin}))}};class rs{constructor(t){this.feedbackService=t}async addSponsoredLabel({parentHtmlId:t,placement:n,feedback:i}){return ns(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(as(t,i),he(n)),!0):(this.feedbackService.logTransparencyInfoMissing(he(n)),u("Transparency Information missing"),!1)}openModal(t){this.feedbackService.openModal(new Hi(t))}labelRendered({placement:t}){this.feedbackService.labelRendered(he(t))}}const os=e=>"/af/feedback-link?pl="+e,as=(e,t)=>{const n=JSON.parse(JSON.stringify(t.url.parameters));return n.adPlacementMetaData.pageUrl=be(n.adPlacementMetaData.pageUrl),new Bi(e,t.style,t.label.text,t.label.style,t.position==="TOP"?rt:st,os(encodeURIComponent(JSON.stringify(n))),t.hidden)},cs=e=>{ge().labelRendered({placement:{id:e.placementId,name:e.placementName}})},ds=e=>{var t;ge().openModal((t=e.adUnitWrapperId)!=null?t:e.adUnitPlacementId)},ls=async e=>{if(!await ge().addSponsoredLabel(ms(e)))throw new Error("Failed to create sponsored label and feedback link")},ms=e=>{var i;const t=e.adPlacementMetaData,n=e.adFeedbackInfo;return{parentHtmlId:(i=e.adUnitWrapperId)!=null?i:e.adUnitPlacementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:"BOTTOM",hidden:!n.boolFeedback,style:e.feedbackDivStyle,url:{parameters:{adPlacementMetaData:{adElementId:t.adElementId,pageType:t.pageType,pageUrl:be(t.pageUrl),slotName:t.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:yt(n.sponsoredText),style:e.advertisementStyle}}}};function ot(e,t,n){var i={},s=i.noTrailing,r=s===void 0?!1:s,o=i.noLeading,a=o===void 0?!1:o,c=i.debounceMode,l=c===void 0?void 0:c,h,p=!1,x=0;function k(){h&&clearTimeout(h)}function we(D){var ee=D||{},I=ee.upcomingOnly,fe=I===void 0?!1:I;k(),p=!fe}function vt(){for(var D=arguments.length,ee=new Array(D),I=0;I<D;I++)ee[I]=arguments[I];var fe=this,It=Date.now()-x;if(p)return;function te(){x=Date.now(),t.apply(fe,ee)}function bt(){h=void 0}!a&&l&&!h&&te(),k(),l===void 0&&It>e?a?(x=Date.now(),r||(h=setTimeout(l?bt:te,e))):te():r!==!0&&(h=setTimeout(l?bt:te,l===void 0?e-It:e))}return vt.cancel=we,vt}const hs="sfImpression",at="viewablelatency",q=(e,t,n)=>({csaKey:e,csmKey:t,csmMessage:n}),us=q("bodyBegin","bb"),gs=q("bodyBegin","bb",hs),ps=q("viewablelatency:bodyBegin","bb",at),ct=q("viewablelatency:loaded","ld",at),X=async(e,t)=>{if(e!=null&&e.trim().match(/^\d{1,4}px$/g))return await ws(parseInt(e,10),t,(n,i)=>{const s=wi(n);return n&&s<=i})},ws=async(e,t,n)=>new Promise(i=>{const s=()=>{n(t,e)&&(i(),window.removeEventListener("scroll",r),window.removeEventListener("resize",r))},r=se(ot(20,()=>{s()}),u);window.addEventListener("scroll",r),window.addEventListener("resize",r),s()}),fs=(e,t,n,i,s,r)=>{const o=e==null?void 0:e[t];o!=null&&o.valid&&(o.loaded=!0,o.viewed&&(T().sendLatencyMetric({latencyMetricType:ct,placementId:i,placementName:n,placementDivId:s,timestamp:new Date(r)}),d("htmlviewed:loaded",{id:i,name:n})))},j=async e=>{const t=C(e),i={root:Es(t)?null:document.documentElement};await yi(t,i)},Es=e=>{let t=e;for(;t;){if(window.getComputedStyle(t,null).getPropertyValue("position")==="fixed")return!0;t=t.parentElement}return!1},vs=async(e,t)=>{t.firePixelsAfter&&await X(t.firePixelsAfter,w(t)),await j(t),e.sendMessageToAd(t.arid,"fireImpression",{measurementMethod:ze,isNoInventory:!1})};class Is{constructor(t,n,i,s){this.id=t,this.name=n,this.wrapperDivId=i,this.divId=s}collapse(t,n){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none",y({metricName:"placement:collapse",adDetails:t,additionalDimensions:{code:n,isBlank:"".concat(bs(t)),creativeId:t.adCreativeMetaData.adCreativeId}}),m("safeframe:placement:collapse"),d("safeframe:placement:collapse",{id:this.id,name:this.name})}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}}const bs=e=>{const t=e.htmlContentEncoded.match(/<div id="ad">\s*(.*?)\s*<\/div>/s);return t?t[1].trim()==="":!1},dt=e=>new Is(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId),Ss=(e,t)=>{ne("ChangeSize API has been deprecated"),As(e)&&Ps(e,t)&&dn(e,t)},Ps=(e,t)=>{if(!ys(t))return u("Size w:'".concat(t.width,"', h:'").concat(t.height,"' is not allow-listed for '").concat(e.placementName,"'")),!1;const n=w(e);return Cs(e,t)&&(n.style.maxHeight=L(t.height)),A(t.height)||A(t.width)?(n.style.width=L(t.width),n.style.height=L(t.height)):(n.removeAttribute("style"),n.style.aspectRatio="".concat(parseInt(t.width)," / ").concat(parseInt(t.height))),!0},ys=e=>{const t=L(e.height),n=L(e.width);return[{width:"100%",height:"169px"},{width:"300px",height:"250px"}].some(s=>t===s.height&&n===s.width)},As=e=>{var t,n;return e.slotName==="hero-quick-promo"&&(((t=e.adCreativeMetaData)==null?void 0:t.adCreativeTemplateName)==="Personalized Responsive eCommerce"||!((n=e.adCreativeMetaData)!=null&&n.adCreativeTemplateName))&&e.mediaType==="D"},Cs=(e,t)=>e.slotName==="hero-quick-promo"&&A(t.width),Ts=(e,t)=>g(t.metricName,{name:e.placementName,id:e.placementId}),_s=(e,t)=>{u(t.message+": "+e.placementName,t.error),u(t.message,t.error)},Ns=(e,t)=>{ie(t.message+": "+e.placementName,t.error)},Z="btr:impression",lt=e=>e!==1004&&nn().isT1(),mt=(e,t)=>!t.isViewabilityObstructed(e,0),Ls=(e,t,n)=>{const i=setInterval(()=>{mt(e,t)&&(clearInterval(i),n())},100);return i},Ms=(e,t,n,i)=>{let s;De({target:e.div,onIntersection:r=>{mt(e,i)?ht(e,t,n,r):s=Ls(e,i,()=>ht(e,t,n,r))},onExit:()=>{clearInterval(s)},options:{threshold:0}})},ht=async(e,t,n,i)=>{var s;await t.impressionPixel.fire(e),n&&((s=t.btrPixel)==null||s.fire(e)),t.measurabilityPixel.fire(e),i.disconnect()},Rs=async e=>{var t;e.firePixelsAfter&&await X(e.firePixelsAfter,w(e)),await j(e),lt(Number(e.adCreativeMetaData.adProgramId))||((t=et(Q(e)))==null||t.fire({id:e.placementId,name:e.placementName,div:w(e),deviceType:e.deviceType}),xs(e))},xs=e=>{d(Z,{id:e.placementId,name:e.placementName},1),m(Z,1);const t=e.adCreativeMetaData.adProgramId?e.adCreativeMetaData.adProgramId:"unknown";m(Z+":program:"+t,1);const n=Ne(e);m(Z+":template:"+n,1)},ks=async e=>{var i,s;const t=Q(e),n={id:e.placementId,name:e.placementName,div:w(e),deviceType:e.deviceType};await((i=Oi(t))==null?void 0:i.fire(n)),(s=Vi(t))==null||s.track(n)},Os=async(e,t)=>{const n=w(e);await X(e.firePixelsAfter,n),await j(e);const i=Q(e),s={id:e.placementId,name:e.placementName,div:n,deviceType:e.deviceType};if(lt(Number(e.adCreativeMetaData.adProgramId))){const o=$();Ms(s,{impressionPixel:tt(i),btrPixel:et(i),measurabilityPixel:nt(i)},t.isBtr,J(o))}else nt(i).fire(s);ks(e);const r=Vs(i,e,s);Qe.set(s,t.isBtr),r.track(s)},Vs=(e,t,n)=>{const i=()=>Tn(n);return Mi(t.mediaType,n.div,e,t.deviceType,i)},ut="gw-video-orchestrator",Bs=(e,t,n)=>{var i;(i=window.P)==null||i.when(ut).execute(s=>{try{s.subscribe(e,t,n)}catch(r){ne("gw-video-orchestrator error: ".concat(JSON.stringify(r)))}})},Hs=e=>gt(e),Fs=()=>gt(),gt=e=>{var t;(t=window.P)==null||t.when(ut).execute(n=>{n.elect(e)})};let R=null;const Us=(e,t,n)=>{const i=s=>n.sendCustomMessageToAd(e.arid,"videoAutoplayResponse",s);Ys(e.pageType)?Bs(C(e),i,t):R===e.arid?i(!0):R===null&&Js(C(e))?(R=e.arid,i(!0)):i(!1)},Ws=()=>{Fs(),R=null},$s=e=>{Hs(C(e)),R=e.arid},Ys=e=>(e==null?void 0:e.toLowerCase())==="gateway",Js=e=>![...document.getElementsByTagName("video")].some(t=>!t.paused&&bi(e,t)),pt=new Set;class Gs{constructor(t,n){this.hms=t,this.hc=n,this.expandInlineListeners=new Map,this.originalHeights=new Map,this.changeSize=Ss,this.fireImpressionWithDelay=async i=>{await vs(this.hms,i)},this.logAPIInvocation=(i,s)=>{const r="messenger:".concat(s.apiName);m(r),d(r,{id:i.placementId,name:i.placementName})},this.logError=_s,this.logFatal=Ns,this.logCsaEvent=Ts,this.sendLatencyMetric=(i,s)=>Ks(i,s),this.fireViewableLatencyMetrics=async(i,s)=>{fs(this.hc.viewableLatencyTrackers,i.arid,i.placementName,i.placementId,i.adUnitPlacementId,s.adLoadedTimestamp)},this.countMetric=(i,s)=>{s.isGlobal?m(s.metricMsg,s.value):d(s.metricMsg,{id:i.placementId,name:i.placementName},s.value)},this.requestVideoAutoplay=(i,s)=>{m("common:supported:command:requestVideoAutoplay"),Us(i,s,this.hms)},this.releaseVideoAutoplay=()=>{m("common:supported:command:releaseVideoAutoplay"),Ws()},this.haveVideoAutoplayPermission=i=>{m("common:supported:command:haveVideoAutoplayPermission"),$s(i)},this.feedbackLabelRendered=i=>{cs(i)},this.feedbackOpenModal=i=>{ds(i)},this.collapseSlot=(i,s)=>{var r,o;if((r=window.APE_SF)!=null&&r.collapsedPlacements.has(i.adUnitPlacementId)){ne("Slot already collapsed");return}dt(i).collapse(i,s),(o=window.APE_SF)==null||o.collapsedPlacements.add(i.adUnitPlacementId)},this.sendEventAddedCreative=async i=>{pt.has(i.placementId)||(i.firePixelsAfter&&await X(i.firePixelsAfter,w(i)),await j(i),tt(Q(i)).fire({id:i.placementId,name:i.placementName,div:w(i),deviceType:i.deviceType}),pt.add(i.placementId))},this.sendEventCreativeBeginToRender=Rs,this.sendEventCreativeLoaded=async(i,s)=>{await Os(i,s)},this.resizeForImageOnlyTemplate=i=>w(i).classList.add("is-image-oo"),this.sendSfVideoContinuousPlaytimeSeconds=(i,s)=>{const r=w(i),o=new CustomEvent(Fe,{detail:s});r.dispatchEvent(o)},this.expandInline=i=>{if(!B().isT1()&&!B().isT2()&&!ke().isT1()){this.logError(i,{message:"expandInline called without weblab enabled"});return}const s=w(i);if(!s)return;const r=s.style.height||getComputedStyle(s).height;this.originalHeights.set(i.adUnitPlacementId,r);const o=this.expandInlineListeners.get(i.adUnitPlacementId);o&&o.forEach(({type:h,callback:p})=>{window.removeEventListener(h,p)});const a=pe(i.slotName)?"312px":"307px";s.style.transition="height 0.3s ease",s.style.setProperty("height",pe(i.slotName)?a:Oe(a),"important");const c=h=>{this.hms.sendMessageToAd(i.arid,"triggerEventInIframe",{eventType:h.type}),this.resetSlot(i)},l=["click","swipe","tap"].map(h=>({type:h,callback:c}));l.forEach(({type:h,callback:p})=>{window.addEventListener(h,p,{once:!0})}),this.expandInlineListeners.set(i.adUnitPlacementId,l)},this.resetSlot=i=>{if(!B().isT1()&&!B().isT2()&&!ke().isT1()){this.logError(i,{message:"resetSlot called without weblab enabled"});return}const s=w(i);if(!s)return;s.style.transition="height 0.3s ease";const r=this.originalHeights.get(i.adUnitPlacementId)||"55px";s.style.setProperty("height",pe(i.slotName)?r:Oe(r),"important"),this.originalHeights.delete(i.adUnitPlacementId)}}}const Ks=(e,{latencyMetricType:t,timestamp:n})=>{T().sendLatencyMetric({latencyMetricType:t,placementName:e.placementName,placementId:e.placementId,placementDivId:e.adUnitPlacementId,timestamp:n})},Q=e=>{var t;return{aaxImpPixelUrl:e.aaxImpPixelUrl,aaxInstrPixelUrl:e.aaxInstrPixelUrl,abpAcceptable:e.abpAcceptable,abpStatus:(t=e.abpStatus)!=null?t:"-1",btrPixelUrl:e.btrPixelUrl,skAdNetwork:e.skAdNetwork,loggingContext:{aaxProgramId:Number(e.adCreativeMetaData.adProgramId)}}},zs=["desktop-detail-ilm","vindp-desktop-atf-ilm",..._n],pe=e=>zs.includes(e);class qs{constructor(t,n){this.supportedCommands=t,this.eventsChannel=n,this.receiveMessage=async({data:{command:i,adDetails:s,payload:r}})=>{try{const a={...this.eventsChannel,...this.supportedCommands}[i];a&&await a(s,r)}catch(o){const a="Problem with message: "+JSON.stringify(r);u(a,o)}}}}class Xs{constructor(t){this.adMap=t,this.sendMessageToAd=(n,i,s)=>{const r=this.adMap[n].messagePort,o={command:i,data:s};r.postMessage(o)},this.sendCustomMessageToAd=(n,i,s)=>{const r={key:i,data:s};this.sendMessageToAd(n,"customMessage",r)}}}class js{constructor(t={},n={},i={}){this.adMap=t,this.ADS_HANDLERS=n,this.viewableLatencyTrackers=i}}const wt=/AdPlacementStyleAssets|apePlacements/,Zs=e=>{var i;const n=performance.getEntriesByType("resource").find(s=>{var r;return(r=s.name.match(wt))==null?void 0:r[0]});if(n){const s=(i=n.name.match(wt))==null?void 0:i[0];y({metricName:"asset:load:timing",adDetails:e,additionalDimensions:{...s&&{assetName:s},assetUrl:n.name,dns:String(n.domainLookupEnd-n.domainLookupStart),tcp:String(n.connectEnd-n.connectStart),ttfb:String(n.responseStart-n.requestStart),download:String(n.responseEnd-n.responseStart),total:String(n.responseEnd-n.startTime)},once:!0})}},Qs=e=>{try{d("coordinate:x",e,e.div.getBoundingClientRect().x),d("coordinate:y",e,e.div.getBoundingClientRect().y)}catch(t){return}},Ds=(e,t,n)=>{T().sendLatencyMetric({latencyMetricType:gs,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),n&&(T().sendLatencyMetric({latencyMetricType:us,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId,timestamp:n}),We({latencyEvent:"wb",placement:t,timestamp:n})),d(xt,t),g(Ht,t),d(kt,t),g(Ft,t)},er=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)},tr=e=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e),document.removeEventListener("visibilitychange",e)},ft=(e,t,n)=>e>0?n>e:t>0,Et=(e,t,n,i,s,r)=>{var a,c;const o=(c=(a=document==null?void 0:document.getElementById)==null?void 0:a.call(document,n))==null?void 0:c.getBoundingClientRect();if(o&&ft(o.top,o.bottom,K())&&ft(o.left,o.right,de())){if(T().sendLatencyMetric({latencyMetricType:ps,placementId:s,placementName:i,placementDivId:n,timestamp:new Date}),e[r].loaded){T().sendLatencyMetric({latencyMetricType:ct,placementId:s,placementName:i,placementDivId:n,timestamp:new Date});const l={id:s,name:i};d("adplacements:htmlviewed:loaded:",l),d("adplacements:htmlviewed",l)}t.viewed=!0,tr(t.tracker)}},nr=(e,t)=>{if(!e[t.arid]){e[t.arid]={valid:!1};try{const n=e[t.arid];Et(e,n,t.adUnitPlacementId,t.placementName,t.placementId,t.arid);const i=se(ot(20,()=>{Et(e,n,t.adUnitPlacementId,t.placementName,t.placementId,t.arid)}),u);er(i),n.tracker=i,n.valid=!0}catch(n){throw u("Error initializing viewable latency instrumentation",n),n}}};class ir{constructor(t,n){this.hc=t,this.hmr=n,this.collapsedPlacements=new Set,this.initializeAdMap=(i,s)=>{try{this.hc.adMap[i.arid]={messagePort:s}}catch(r){u("Error creating safeFrame ".concat(i.slotName),r)}},this.secondPhaseLoadAd=async(i,s,r,o)=>{await this.setupMessageChannel(r,s,o)},this.setupMessageChannel=async(i,s,r)=>{O("perf:sf:host","Start setupMessagePort",s),this.initializeAdMap(s,i);const o=this.hc;o.ADS_HANDLERS[s.arid]=o.ADS_HANDLERS[s.arid]||{};const a=dt(s);Qs(a),Ds(s,a,r),Zs(s),nr(o.viewableLatencyTrackers,s);try{tn().isT1()||await ls(s),sr(o,s,this.hmr)}catch(c){throw a.collapse(s,"HOSTSETUP"),c}}}}const sr=(e,t,n)=>{e.adMap[t.arid].messagePort.onmessage=n.receiveMessage},rr=()=>{const e=new js,t=new Xs(e.adMap),n=An(t),i=new qs(new Gs(t,e),n);return new ir(e,i)},or=()=>{O("perf:sf:host","initSafeframeHostDesktop"),!window.APE_SF&&(O("perf:sf:host","initSafeframeHostDesktop init"),window.APE_SF=rr())};se(()=>or(),u,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.bbb64thf.js.map
